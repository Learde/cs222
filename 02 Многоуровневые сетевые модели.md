Общая схема сетевых моделей
![[Pasted image 20230630011452.png|300]]
Принципы:
- Деление на уровни, за счет этого взаимодействие приложений через сеть становится проще
- Каждый уровень взаимодействует с сетью через такой же уровень (на скрине *одноуровневое взаимодействие*)
- Каждый уровень может пользоваться услугами нижележащего уровня
- Соответственно каждый уровень предоставляет услуги вышележащим

--- 

Сетевая модель:
![[Pasted image 20230630004242.png|300]]
Она определяет:
* **Службы** - то, что будет сделано на данном уровне. Иначе говоря, это функция (или несколько функций), которые выполняет уровень. Каждый сетевой уровень запрашивает определенную сетевую службу от нижележащего уровня. Протокол уровня определяет структуру данных и формат пакета для выполнения запрашиваемой сетевой службы
* **Интерфейс** - то, как обращаться к другим уровням. То есть набор функций и структур данных, который нижележащий уровень предоставляет вышележащему
* **Протокол** - правила, определяющие взаимодействие между системами в рамках одного уровня

Пример: Почтовое отделение
* **Служба** - упаковка посылок, отправка адресату. Может использовать интерфейс, например, компании-перевозчика
* **Протокол** - формат адреса, например:
	* Кому
	* Улица и дом
	* Город
* Предоставляемый **интерфейс** - функция отправки письма/посылки, где адрес должен соответствовать определенному выше протоколу

---

Пример трехуровневой модели
![[Pasted image 20230630012815.png|500]]

Философы используют функции переводчиков на слое ниже, переводчики используют функции почтовых отделений

---

Упрощенная схема передачи сообщения
![[Pasted image 20230630020722.png|500]]

1. Передаваемые информация формируется на самом верхнем уровне - на уровне работающего приложения
2. Эта информация делится на пакеты 
3. Пакет спускается по уровням модели, получая заголовок и концевик. Они содержат какую-то функциональную информацию о данном уровне (например, *адрес*)
4. Далее пакет со всеми заголовками (и концевиками) отправляется получателю
5. Пакет проходит по всем уровням в обратном порядке, на каждом из которых происходит считывание соответствующего заголовка/концевика, после чего он удаляется
6. Таким образом до получателя доходит в итоге исконное сообщение

***Замечание**. На деле сообщение с заголовками/концевиками проходит сжатие, шифрование, расщепление, посему схема, изображенная на картинке выше, не совсем соответствует действительности (на разных уровнях сообщение может приобретать другой вид, но в итоге от отправителя до получателя дойдет одно и то же сообщение M)*

---

# OSI

**OSI** ISO (*Open Systems Interconnection Reference Model, эталонная модель взаимодействия открытых систем*) - абстрактная модель для сетевых коммуникаций и разработки сетевых протоколов. Представляет многоуровневый подход к сети. Каждый уровень обслуживает свою часть процесса взаимодействия. Благодаря такой структуре совместная работа сетевого оборудования и программного обеспечения становится гораздо проще и понятнее.
*<sup>*</sup>**ISO** (International Organization for Standardization) - Международная организация по стандартизации*

Схема ISO:
![[Pasted image 20230630025557.png|250]]

Уровни снизу вверх и их задачи:
1. **Физический** - передача битов данных по сети
2. **Канальный** (*уровень передачи данных*) - передача **кадров** (*наборов битов*) между двумя компьютерами сети, непосредственно связанных между собой, определение как и кому посылать кадры
3. **Сетевой** - управление подсетью, определение маршрутов, доставка информации от отправителя к получателю, соединение разнородных сетей
4. **Транспортный** - с его помощью информация переходит от отправителя к получателю (пользуется услугами, предоставляемыми сетевым уровнем)
5. **Сеансовый** - организация сеансов связи (продолжительного взаимодействия), определение кто в каком порядке передает сообщения, решает задачу синхронизации между абонентами
6. **Уровень предоставления** данных - занимается синтаксисом и семантикой данных, передающихся по сети
7. **Прикладной** - обеспечивает взаимодействие приложений с сетью

***Замечание**. В настоящее время основным используемым семейством протоколов является TCP/IP, разработка которого не была связана с моделью OSI. За все время существования модели OSI она не была реализована, и, по-видимому, не будет реализована никогда. Сегодня используется только некоторое подмножество модели OSI. Считается, что модель слишком сложна, а её реализация займёт слишком много времени. Получается, что на OSI все ссылаются, но на практике ее не используют, а TCP/IP повсеместно используют, но модель устарела.*

---

**Открытый набор протоколов** - это такой набор протоколов, у которых описание и детали опубликованы. Иначе набор протоколов называется **закрытым**.

**Открытая система** - это такая система, которая реализует открытые протоколы, несмотря на то, что код программы может быть закрытым.
*Пример: сетевые компоненты Windows (код закрыт, но реализуют открытые протоколы)*

**Закрытая система** - реализует закрытые протоколы.
*Пример: Skype (протокол не опубликован, а трафик данной программы шифруется)*

---
Далее идут уровни OSI в более подробном рассмотрении

#### Физический уровень (Physical Layer) 
**Задачи**: Преобразует биты в исходящие сигналы, принимает сигналы и переводит их в биты. Данные рассматриваются как поток битов.

**Уровень определяет**:
- характеристики сигналов
- среду передачи
- физическую топологию среды передачи
- механические и физические спецификации спецификации среды передачи
- интерфейсы (разъемы) оборудования 

**Принципиальные вопросы**:
- Если одно устройство передает единицу, получает ли второе устройство единицу, а не ноль?
- Какое напряжение использовать для единицы, а какое для нуля?
- Сколько миллисекунд длится бит?
- Может ли передача производиться в двух направлениях одновременно?
- Как устанавливается начальная связь и как она прекращается, когда обе стороны закончили задачи?
- Из скольких проводов должен состоять кабель и какие функции у каждого из проводов?


#### Канальный уровень (*уровень передачи данных, Data Link Layer*)
**Задачи**: Передает кадры (*frames, наборы битов*) между двумя компьютерами сети, непосредственно связанными между собой

**Функции**:
- Взаимодействие с сетевым уровнем (посредством *протокола MAC*)
- *Надежная доставка*
- *Управление потоком*
- Для идентификации компьютеров используются MAC-адреса

**Дополнительные функции**:
- *Обнаружение ошибок*
- *Исправление ошибок*
- *Дуплексная и полудуплексная передача*

**Технологии**: Ethernet (802.3), WiFi (802.11), Token Ring (802.5), SONET/SDH

##### Пояснения

**Протокол MAC** (*Media Access Control, управление доступом к носителю*) - определяет правила передачи кадра в линию. 
- В простейшем случае - двухточечной линии с единственным отправителем на одном конце и получателем на другом конце - протокол MAC или очень прост, или вовсе отсутствует - кадр можно передать по линии в любой момент, когда она свободна
- Более интересный случай - когда несколько узлов одновременно используют один широковещательный канал. В этот момент наступает так называемая проблема коллективного доступа и протокол MAC призван координировать передачу кадров нескольких узлов

**Надежная доставка** - когда протокол канального уровня предоставляет услугу по надежной доставке, он гарантирует перемещение каждого информационного блока по линии связи без ошибок. Служба надежной доставки поддерживается с помощью механизмов подтверждений и повторных передач. На канальном уровне ошибки исправляются локально — на той линии связи, на которой они возникают, что позволяет отказаться от повторной передачи данных протоколом транспортного или прикладного уровня. 
***Замечание**. В линиях с низкой вероятностью ошибок надежная доставка на канальном уровне может оказаться излишней. К таким линиям относятся волоконно-оптические и экранированные кабели, а также различные категории линий типа «витая пара». Поэтому многие протоколы для кабельных линий не предоставляют услуги по надежной доставке.*

**Управление потоком** - узлы на каждой стороне линии связи обладают буферами для хранения кадров ограниченного размера. Это порождает потенциальную проблему, так как кадры могут поступать на получающий узел быстрее, чем этот узел способен их обрабатывать. Без управления потоком буфер получателя может переполниться, а кадры будут потеряны. Протокол канального уровня должен обеспечивать такое управление, чтобы не возникало этой ситуации.

**Обнаружение ошибок** - принимающий узел может неверно посчитать, что значение бита в кадре равно нулю, в то время как передавалась единица, и наоборот. Подобные битовые ошибки вызываются ослаблением сигнала и электромагнитными помехами. Поскольку нет смысла передавать дальше данные дальше, многие протоколы канального уровня предоставляют услугу по обнаружению ошибок в кадре. Для этого передающий узел добавляет к кадру биты обнаружения ошибок (контрольную сумму), а получающий узел выполняет проверку контрольной суммы.

**Исправление ошибок** - поддерживает расширенная служба обнаружения ошибок. Такая служба способна не только обнаружить ошибку в кадре, но также определить, в каком именно разряде она произошла, и таким образом исправить некоторые ошибки. Как правило, исправление ошибок возможно только для заголовка пакета.

**Дуплексная и полудуплексная передача**
- При *дуплексной передаче* оба узла могут передавать друг другу пакеты **одновременно**
- При *полудуплексной передаче* оба узла тоже могут передавать друг другу пакеты **поочередно**

**SONET/SDH**. *Synchronous Optical Networking* (**SONET**) и *Synchronous Digital Hierarchy* (**SDH**) - это стандартизированные протоколы, которые передают несколько цифровых потоков данных по оптическому волокну с использованием лазеров или высококогерентного света от светодиодов (LED). При низкой скорости передачи данные также могут передаваться через электрический интерфейс. Этот метод был разработан для замены системы *Plesiochronous Digital Hierarchy* (**PDH**). 
**SONET** — это набор транспортных контейнеров, обеспечивающих доставку различных протоколов, включая традиционную телефонию, ATM, Ethernet и TCP / IP. Таким образом, SONET сам по себе не является собственным протоколом связи, а протоколом передачи данных.
Как **SDH**, так и **SONET** широко используются в настоящее время: SONET в Соединенных Штатах и Канаде, а SDH - в остальном мире. Хотя стандарты SONET были разработаны до SDH, последний считается вариацией SDH.

**PPP** (*Point-to-Point Protocol, протокол точка-точка*) - это механизм для создания и запуска IP (Internet Protocol) и других сетевых протоколов на последовательных линиях связи — будь это прямая последовательная связь (по нуль-модемному кабелю), связь поверх Ethernet, модемная связь по телефонным линиям, мобильная связь по технологиям CSD, GPRS или EDGE.
Проще говоря, PPP используется для установления прямой связи между двумя узлами сети. 
Широко применяется для соединения компьютеров с помощью телефонной линии; поверх широкополосных соединений. Многие интернет-провайдеры используют PPP для предоставления доступа в Интернет. Кроме того, PPP используется в мобильной связи (в частности, в сетях GSM) для соединения терминалов с Интернетом
xDLS соединения используют **PPPoE** (*Point-to-Point Protocol over Ethernet*) **PPPoA** (*Point-to-Point Protocol over ATM*)


#### Сетевой уровень (Network Layer)
**Задачи**: Отвечает за передачу датаграмм между ***удаленными*** компьютерами.

**<sup>*</sup>Датаграмма** - блок информации

**Функции**:
- адресация компьютеров во всей глобальной сети (IP-адреса)
- *выбор маршрута доставки сообщений*
- **не** обеспечивает надежность доставки (искажения, потери, изменение порядка следования)
- *best-effort delivery*

**Протоколы**: IP (Internet Protocol), ARP, RARP, ICMP, DHCP

##### Пояснения

**Выбор маршрута доставки сообщений** - одна из важнейших функций этого уровня. Маршруты могут:
- Жестко задаваться в виде таблиц и редко меняться
- Задаваться в начале каждого соединения (например, терминальной сессии)
- Задаваться динамически, то есть вычисляться заново для каждого пакета с учетом текущей загруженности сети

Если в подсети одновременно присутствует слишком большое количество пакетов, то они могут закрыть дорогу друг другу, образуя заторы в узких местах. *Недопущение подобной закупорки также является задачей сетевого уровня*. В более общем смысле сетевой уровень занимается предоставлением определенного уровня сервиса (это касается задержек, времени передачи, вопросов синхронизации).

При путешествии пакета из одной сети в другую также может возникнуть ряд проблем. Может отличаться способ адресации, сеть может отказаться принимать пакет из-за слишком большого веса этого пакета, могут различаться протоколы и так далее. *Все эти проблемы разрешает сетевой уровень.* 

**best-effort delivery** – передача датаграмм скорейшим образом с учетом имеющихся возможностей без гарантии отсутствия потерь из-за переполнения буферов на маршрутизаторах (и по др. причинам).

**ARP** (*Address Resolution Protocol, протокол преобразования адресов*) - протокол, который в сетях TCP/IP используется для преобразования IP-адреса (сетевого адреса) в MAC-адрес (канальный адрес).

**RARP** (*Reverse Address Resolution Protocol, обратный протокол преобразования адресов*) - протокол, обратный протоколу ARP, то есть преобразует MAC-адрес в IP-адрес.

**Протоколы маршрутизации**: RIP (в локальных сетях), BGP (в магистральный сетях) - работают на прикладном уровне.

**IP** (*Internet Protocol*)
- реализует обмен информации датаграммами (IP-пакетами)
- для адресации узлов сети используется адрес длиной 4 байта
- обеспечивает в случае необходимости фрагментацию IP-сегментов
- не гарантирует правильность доставки IP-сегментов адресату и вообще саму доставку
- не имеет средств управления интенсивностью передачи IP-сегментов посылающей стороной (flow control)
- не гарантирует правильную последовательность IP-сегментов на принимающей стороне

**ICMP** (*Internet Control Message Protocol, протокол межсетевых управляющих сообщений*) — сетевой протокол, входящий в стек протоколов TCP/IP. В основном ICMP используется для передачи сообщений об ошибках и других исключительных ситуациях, возникших при передаче данных, например, запрашиваемая услуга недоступна или хост, или маршрутизатор не отвечают.

**DHCP** (*Dynamic Host Configuration Protocol, протокол динамической настройки узла*) — сетевой протокол, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP. Данный протокол работает по модели «клиент-сервер». Для автоматической конфигурации компьютер-клиент на этапе конфигурации сетевого устройства обращается к так называемому серверу DHCP и получает от него нужные параметры. Сетевой администратор может задать диапазон адресов, распределяемых сервером среди компьютеров. Это позволяет избежать ручной настройки компьютеров сети и уменьшает количество ошибок.


#### Транспортный уровень
**Задачи**: Осуществляет *надежную* доставку данных от отправителя к получателю

**Функции**:
- установление надежного соединения
- контроль ошибок: искажения пакетов, потери, изменение порядка следования, дублирование
- контроль потока данных
- сегментирует и повторно собирает данные в один поток

**Адресация соединений**: IP1, P1, IP2, P2

**Протоколы**: TCP, UDP

##### Пояснения

Наиболее популярной разновидностью транспортного соединения является защищенный от ошибок канал между двумя узлами, поставляющий сообщения или байты в том порядке, в каком они были отправлены. Однако транспортный уровень может предоставлять и другие типы сервисов, например пересылку отдельных сообщений без гарантии соблюдения порядка их доставки или одновременную отправку сообщения различным адресатам по принципу широковещания. Тип сервиса определяется при установке соединения.

**Основная функция транспортного уровня** — принять данные от сеансового уровня, разбить их при необходимости на небольшие части, передать их сетевому уровню и гарантировать, что эти части в правильном виде прибудут по назначению.

**UDP** (*User Datagram Protocol, протокол пользовательских датаграмм*) - протокол передачи датаграмм без установления соединения. Также его называют протоколом «ненадёжной» передачи, в смысле невозможности удостовериться в доставке сообщения адресату, а также возможного перемешивания пакетов. Однако UDP-датаграммы имеют поле контрольная сумма сообщения, что гарантирует правильность доставки сообщения, в случае, если оно дошло до адресата.

**TCP** (*Transmission Control Protocol, протокол управления передачей*) - «гарантированный» транспортный механизм с предварительным установлением соединения, предоставляющий приложению надёжный поток данных, дающий уверенность в безошибочности получаемых данных, перезапрашивающий данные в случае потери и устраняющий дублирование данных. TCP позволяет регулировать нагрузку на сеть, а также уменьшать время ожидания данных при передаче на большие расстояния. Более того, TCP гарантирует, что полученные данные были отправлены точно в такой же последовательности.

![[Pasted image 20230630215032.png|450]]


#### Сеансовый уровень (Session layer)
**Задачи**: Позволяет двум сторонам поддерживать длительное взаимодействие (сеанс) по сети 

**Функции**:
- установление сеанса
- поддержка/управление сеансом
- разрыв сеанса
- синхронизация передачи данных (можно помещать контрольные точки в поток данных и возвращаться назад к определенной точке)

**Протоколы**: H.245, SSH и другие

##### Пояснения

Сеансовый уровень отвечает за поддержание сеанса связи, позволяя приложениям взаимодействовать между собой длительное время. Уровень управляет созданием/завершением сеанса, обменом информацией, синхронизацией задач, определением права на передачу данных и поддержанием сеанса в периоды неактивности приложений. Синхронизация передачи обеспечивается помещением в поток данных контрольных точек, начиная с которых возобновляется процесс при нарушении взаимодействия.

**H.245** (*Call Control Protocol for Multimedia Communication*) – ответствен за установление и передачу служебной информации мультимедиа-соединения: типа шифрования, контроля потока, управляющих сигналов для предотвращения джиттера, передачи различных опций соединения.

**Джиттер** (*jitter, дрожание, фазовое дрожание цифрового сигнала данных*) - нежелательные фазовые или частотные отклонения передаваемого сигнала.

**SSH** (*Secure SHell, безопасная оболочка*) - сетевой протокол сеансового уровня, позволяющий производить удалённое управление операционной системой и туннелирование TCP-соединений (например, для передачи файлов). Шифрует весь трафик, включая и передаваемые пароли. SSH допускает выбор различных алгоритмов шифрования. SSH-клиенты и SSH-серверы доступны для большинства сетевых операционных систем.


#### Уровень представления (Presentation layer)
**Задачи**: преобразование форматов данных, кодирование/декодирование данных

**Примеры преобразования данных**:
- Форматирование
- Сжатие
- Перевод
- Кодирование
- Шифрование

**Протоколы**: SSL и другие

##### Пояснения

Этот уровень отвечает за преобразование протоколов и кодирование/декодирование данных. Запросы приложений, полученные с уровня приложений, он преобразует в формат для передачи по сети, а полученные из сети данные преобразует в формат, понятный приложениям. На этом уровне может осуществляться сжатие/распаковка или кодирование/декодирование данных, а также перенаправление запросов другому сетевому ресурсу, если они не могут быть обработаны локально.

В отличие от более низких уровней, задача которых — достоверная передача битов и байтов, уровень представления занимается по большей части синтаксисом и семантикой передаваемой информации. Чтобы было возможно общение компьютеров с различными представлениями данных, необходимо преобразовывать форматы данных друг в друга, передавая их по сети в неком стандартизированном виде. Уровень представления занимается этими преобразованиями, предоставляя возможность определения и изменения структур данных более высокого уровня.

**Пример**. Имеются две системы:
1. Для представления данных используется расширенный двоичный код обмена иформацией EBCDIC
2. Для представления данных используется американский стандартный код обмена информацией ASCII
Если этим двум системам необходимо обменяться информацией, то нужен *уровень представлений*, который выполнит преобразование и осуществит перевод между двумя различными форматами

**SSL** (*Secure Sockets Layer, уровень защищённых сокетов*) - обеспечивает защищённый обмен данными за счёт аутентификации и шифрования.


#### Прикладной уровень (Application layer)
**Задачи**: Обеспечивает взаимодействие сети и пользователя

**Адресация приложений**: номер порта

**Протоколы**: HTTP, SMTP, POP3, IMAP, FTP

**Протоколы этого уровня определяют совместно используемые сетевые службы, например**:
- WWW
- Электронная почта
- Сетевая печать
- Пересылка файлов через сеть

##### Пояснения

Уровень разрешает приложениям пользователя иметь доступ к сетевым службам, таким как обработчик запросов к базам данных, доступ к файлам, пересылке электронной почты. Также отвечает за передачу служебной информации, предоставляет приложениям информацию об ошибках и формирует запросы к уровню представления. Пример: HTTP, POP3, SMTP.

Прикладной уровень содержит набор популярных протоколов, необходимых пользователям. Одним из наиболее распространенных является протокол передачи гипертекста **HTTP** (*HyperText Transfer Protocol*), который составляет основу технологии Всемирной Паутины. Когда браузер запрашивает веб-страницу, он передает ее имя (адрес) и рассчитывает на то, что сервер будет использовать HTTP. Сервер в ответ отсылает страницу. Другие прикладные протоколы используются для передачи файлов, электронной почты, сетевых рассылок.

---

Общие замечание об OSI (можно считать это так же ее проблемами):
- Избыточность и низкая функциональность верхних уровней
- Учет в стандартах всех теоретически возможных ситуаций
- Сложность спецификаций для реализации
- Очень высокие требования к ресурсам сетевых компьютеров

---

# TCP/IP

Схема TCP/IP в сравнении с OSI:
![[Pasted image 20230630212122.png|400]]

Согласно терминологии TCP/IP элементы сетевого уровня называются подсетями (subnetworks). Идеология TCP/IP допускает, чтобы в качестве "подсетей" выступали реальные сети с их собственными стеками протоколов, узлами, шлюзами и т.п.

Реализация протоколов TCP/IP оказалась наиболее удачной в версиях BSD4.2 и BSD4.3 операционной системы UNIX. Эта реализация является эталоном для всех последующих.

#### ARPANET
ARPANET была исследовательской сетью, финансируемой Министерством обороны США. В конце концов она объединила сотни университетов и правительственных зданий при помощи выделенных телефонных линий. Когда впоследствии появились спутниковые сети и радиосети, возникли большие проблемы при объединении с ними других сетей с помощью имеющихся протоколов. Понадобилась новая эталонная архитектура. Таким образом, возможность объединять различные сети в единое целое являлась одной из главных целей с самого начала. Позднее эта архитектура получила название эталонной модели TCP/IP в соответствии со своими двумя основными протоколами.

---

**TCP/IP** — сетевая модель передачи данных, представленных в цифровом виде. Модель описывает способ передачи данных от источника информации к получателю. В модели предполагается прохождение информации через четыре уровня, каждый из которых описывается правилом (протоколом передачи). Наборы правил, решающих задачу по передаче данных, составляют стек протоколов передачи данных, на которых базируется Интернет.

**Стек протоколов** - это набор протоколов разных уровней, достаточный для организации взаимодействия систем.

Каждый из уровней модели может быть реализован тем или иным протоколом, имеющим свой интерфейс для нижнего уровня. А вся модель реализуется посредством стека протоколов.
Каждый протокол работает на определенном уровне и использует услуги, предоставляемые протоколом нижнего уровня, и предоставляет услуги протоколу верхнего уровня.

Схематически стек протоколов передачи данных
![[Pasted image 20230630214449.png|500]]

Как протоколы узнают какой службе выше нужно передать пришедшие данные? Ведь на верхнем уровне может быть несколько протоколов.

Пакеты сетевого протокола IP содержат код, указывающий, какой именно протокол следующего уровня нужно использовать, чтобы извлечь данные из пакета. Это число — уникальный IP-номер протокола. ICMP и IGMP имеют номера, соответственно, 1 и 2.

На транспортном уровне для идентификации служб прикладного уровня (или сеансового) используется номер порта. Существует список стандартных портов TCP и UDP. Например HTTP протокол имеет TCP-порт 80 или 8080

---

Распределение протоколов по уровням в TCP/IP
![[Pasted image 20230630215438.png]]

---

Хорошее видео для понимания основ TCP/IP
<iframe width="560" height="315" src="https://www.youtube.com/embed/2I1HnSN1H9o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>